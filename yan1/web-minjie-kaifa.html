<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-03-26 周六 21:55 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>web前端作业——基于React组件化思路开发的山寨版创新港图书馆大数据可视化平台</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="梁子，软件学院，S0083，3120305385" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">web前端作业——基于React组件化思路开发的山寨版创新港图书馆大数据可视化平台</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7f44ad7">1. 场景及功能介绍</a></li>
<li><a href="#org2a833ec">2. 界面功能实现</a>
<ul>
<li><a href="#org6a0163b">2.1. 总体架构</a></li>
<li><a href="#orgf4153f1">2.2. 各组块实现</a></li>
</ul>
</li>
<li><a href="#org041ea0c">3. 安装与运行</a>
<ul>
<li><a href="#org72de56f">3.1. 安装</a></li>
<li><a href="#orgaa8a2c6">3.2. 运行</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org7f44ad7" class="outline-2">
<h2 id="org7f44ad7"><span class="section-number-2">1</span> 场景及功能介绍</h2>
<div class="outline-text-2" id="text-1">
<p>
本作业拟实现的功能是：一个被目前广泛使用的可视化界面。观察到创新港的图书馆中便有屏幕投放这种前端界面，因此打算仿照之实现一个山寨版本。整体结果图示如下图所示：
</p>


<div id="org18c22ed" class="figure">
<p><img src="file:///d:/图片/interface.png" alt="interface.png" />
</p>
</div>

<p>
从图中可以看出，该页面所实现的功能主要包括以下几个方面：
</p>
<ol class="org-ol">
<li>图书馆进出情况分析；</li>
<li>图书借阅情况分析；</li>
<li>各类基础信息统计；</li>
<li>图书借阅类别分布的统计；</li>
<li>借阅者年级分布的统计；</li>
<li>还书机使用频率曲线；</li>
<li>实时时间显示</li>
<li>没有太大含义的中国地图；</li>
</ol>

<p>
关于实现过程请见下一章。
</p>
</div>
</div>
<div id="outline-container-org2a833ec" class="outline-2">
<h2 id="org2a833ec"><span class="section-number-2">2</span> 界面功能实现</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org6a0163b" class="outline-3">
<h3 id="org6a0163b"><span class="section-number-3">2.1</span> 总体架构</h3>
<div class="outline-text-3" id="text-2-1">
<p>
本作业所描述平台整体上包含了两部分：前端实现和后端实现。当然，由于后端实现较为简单（即基于简单数据库的对数据的整合和处理），因此本章重点介绍前端部分。整体上而言，本文使用阿里巴巴的前端框架dva进行套装，整体上可分为三大模块：
</p>

<ol class="org-ol">
<li>界面。基于react编写相关组件，用以展示每一个模块；</li>
<li>后端数据。使用json对象模拟后端数据，将所有后端数据存放在固定的文件夹中；</li>
<li>操作逻辑和前端数据。基于dva框架进行存储；</li>
<li>风格样式。使用styled-components进行组件化的css样式使用；</li>
<li>可视化，基于百度的echarts进行可视化。</li>
</ol>

<p>
下图展示了整体上的模型结构实现。下面介绍各个组块的实现原则。
<img src="./images/react.png" alt="react.png" />
</p>
</div>
</div>

<div id="outline-container-orgf4153f1" class="outline-3">
<h3 id="orgf4153f1"><span class="section-number-3">2.2</span> 各组块实现</h3>
<div class="outline-text-3" id="text-2-2">
<p>
各个组块的实现均基于react进行，主要包括以下8个原子级别的组块：
</p>

<ol class="org-ol">
<li>时间组块；</li>
<li>标题组块；</li>
<li>地图组块；</li>
<li>图书馆重要统计值数值展示组块；</li>
<li>图书馆进出人数展示组块；</li>
<li>图书借阅榜组块；</li>
<li>图书借阅类别分析组块；</li>
<li>借阅者年级分布展示组块；</li>
<li>还书机使用功能分布组块；</li>
<li>还书机使用频率组块；</li>
</ol>

<p>
基于这八个原子组块，主要将页面划分为三个部分：
</p>
<ol class="org-ol">
<li>顶部，包含标题和当前时间；</li>
<li>左部，包含图书馆进出人数展示、图书借阅榜两大部分；</li>
<li>中部，包含地图和重要统计数值展示；</li>
<li>右部，包含图书馆的一些部分分析结果，及还书机的使用情况；</li>
</ol>

<p>
之后，这三个部分将组成整体的页面。
</p>

<p>
前面已提及，为了更好地展示解耦前端的各个部分，上述各个组块的风格样式以及其交互逻辑均是分离开的，而后使用dva中的connect方法将模型和页面进行拼接。下面以左侧组件试图为例进行介绍。
如前面所述，左侧主要包括图书馆进出人数展示的折线图以及滚动的图书借阅榜，基于此二者的react组件类中的render函数被定义为：
</p>

<div class="org-src-container">
<pre class="src src-js"> render<span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
    <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #7388d6;">{</span> userSitua, trafficSitua, accessFrequency, peakFlow <span style="color: #7388d6;">}</span> = <span style="color: #F5666D;">this</span>.props;
    <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #7388d6;">(</span>
      <span style="color: #204A87;">// </span><span style="color: #204A87;">&#39118;&#26684;</span>
      &lt;LeftPage&gt;
        <span style="color: #909183;">{</span><span style="color: #204A87;">/* </span><span style="color: #204A87;">&#39030;&#37096;&#22270;&#34920;</span><span style="color: #204A87;"> */</span><span style="color: #909183;">}</span>
        &lt;LeftTopBox&gt;
          &lt;BorderBox12 className=<span style="color: #4E9A06;">'left-top-borderBox12'</span>&gt;
            &lt;div className=<span style="color: #4E9A06;">'left-top'</span>&gt;
              &lt;ModuleTitle&gt;
                &lt;i className=<span style="color: #4E9A06;">'iconfont'</span>&gt;&amp;#xe78f;&lt;/i&gt;
                &lt;span&gt;&#20170;&#26085;&#22270;&#20070;&#39302;&#36827;&#20986;&#24773;&#20917;&lt;/span&gt;
              &lt;/ModuleTitle&gt;

              &lt;div className=<span style="color: #4E9A06;">'title-dis'</span>&gt;
                &lt;span&gt;
                  &#24403;&#21069;&#21442;&#35266;&#20154;&#25968;<span style="color: #909183;">(</span>&#23567;&#26102;<span style="color: #909183;">)</span>:
                  &lt;span className=<span style="color: #4E9A06;">'title-dis-keyword'</span>&gt;<span style="color: #909183;">{</span>accessFrequency<span style="color: #909183;">}</span>&#20154;&lt;/span&gt;
                &lt;/span&gt;

                &lt;span&gt;
                  &#20170;&#26085;&#24635;&#20154;&#25968;:
                  &lt;span className=<span style="color: #4E9A06;">'title-dis-keyword'</span>&gt;<span style="color: #909183;">{</span>peakFlow<span style="color: #909183;">}</span>&#20154;&lt;/span&gt;
                &lt;/span&gt;
              &lt;/div&gt;
              <span style="color: #909183;">{</span><span style="color: #204A87;">/* </span><span style="color: #204A87;">&#22270;&#34920;</span><span style="color: #204A87;"> */</span><span style="color: #909183;">}</span>
              &lt;TrafficSituation trafficSitua=<span style="color: #909183;">{</span>trafficSitua<span style="color: #909183;">}</span>&gt;&lt;/TrafficSituation&gt;
            &lt;/div&gt;
          &lt;/BorderBox12&gt;
        &lt;/LeftTopBox&gt;

        <span style="color: #909183;">{</span><span style="color: #204A87;">/* </span><span style="color: #204A87;">&#24213;&#37096;&#22270;&#34920;</span><span style="color: #204A87;"> */</span><span style="color: #909183;">}</span>
        &lt;LeftBottomBox&gt;
          &lt;BorderBox13 className=<span style="color: #4E9A06;">'left-bottom-borderBox13'</span>&gt;
            &lt;div className=<span style="color: #4E9A06;">'left-bottom'</span>&gt;
              &lt;ModuleTitle&gt;
                &lt;i className=<span style="color: #4E9A06;">'iconfont'</span>&gt;&amp;#xe88e;&lt;/i&gt;
                &lt;span&gt;&#26412;&#21608;&#22270;&#20070;&#20511;&#38405;&#27036;&lt;/span&gt;
              &lt;/ModuleTitle&gt;
              <span style="color: #909183;">{</span><span style="color: #204A87;">/* </span><span style="color: #204A87;">&#22270;&#34920;</span><span style="color: #204A87;"> */</span><span style="color: #909183;">}</span>
              &lt;UserSituation userSitua=<span style="color: #909183;">{</span>userSitua<span style="color: #909183;">}</span>&gt;&lt;/UserSituation&gt;
            &lt;/div&gt;
          &lt;/BorderBox13&gt;
        &lt;/LeftBottomBox&gt;
      &lt;/LeftPage&gt;
    <span style="color: #7388d6;">)</span>;
  <span style="color: #707183;">}</span>
<span style="color: #88090B;">}</span>
</pre>
</div>

<p>
从中可以看出，所有的组件均被包括在&lt;LeftPage&gt;之内，在之中，划分得到了底部顶部两个box，而核心的图标区域是两个react组件，TrafficSituation 和 UserSituation。下面先对这几个组件进行简单介绍。
</p>

<p>
首先，LeftPage以及两个box均是针对于css样式风格而撰写的组件，借用了styled-components的写法，如LeftTopBox就包含了如下的样式设定：
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #A52A2A; font-weight: bold;">export</span> <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #0084C8; font-weight: bold;">LeftTopBox</span> = styled.div<span style="color: #4E9A06;">`</span>
<span style="color: #4E9A06;">  position: relative;</span>
<span style="color: #4E9A06;">  height: 4.375rem;</span>
<span style="color: #4E9A06;">  width: 100%;</span>
<span style="color: #4E9A06;">  .left-top-borderBox12 {</span>
<span style="color: #4E9A06;">    width: inherit;</span>
<span style="color: #4E9A06;">    height: inherit;</span>
<span style="color: #4E9A06;">    padding: 0.1875rem;</span>
<span style="color: #4E9A06;">    .left-top {</span>
<span style="color: #4E9A06;">      width: 100%;</span>
<span style="color: #4E9A06;">      height: 100%;</span>
<span style="color: #4E9A06;">      border-radius: 10px;</span>
<span style="color: #4E9A06;">      background-color: rgba(19, 25, 47, 0.6);</span>
<span style="color: #4E9A06;">      .title-dis {</span>
<span style="color: #4E9A06;">        margin-top: 0.1875rem;</span>
<span style="color: #4E9A06;">        display: flex;</span>
<span style="color: #4E9A06;">        justify-content: space-around;</span>
<span style="color: #4E9A06;">        align-items: center;</span>
<span style="color: #4E9A06;">        font-size: 0.2rem;</span>
<span style="color: #4E9A06;">        color: #c0c9d2;</span>
<span style="color: #4E9A06;">        &amp;-keyword {</span>
<span style="color: #4E9A06;">          padding-left: 0.125rem;</span>
<span style="color: #4E9A06;">          color: #47dae8;</span>
<span style="color: #4E9A06;">        }</span>
<span style="color: #4E9A06;">      }</span>
<span style="color: #4E9A06;">    }</span>
<span style="color: #4E9A06;">  }</span>
<span style="color: #4E9A06;">`</span>;
</pre>
</div>

<p>
而两个Situation，均是react化的echarts组件，该组件一方面需要满足可视化库echarts的一些设定，另一方面又需要满足react的封装风格，以出口人流量为例，可以撰写如下:
</p>


<div class="org-src-container">
<pre class="src src-js"><span style="color: #A52A2A; font-weight: bold;">class</span> TrafficSituation <span style="color: #A52A2A; font-weight: bold;">extends</span> PureComponent <span style="color: #707183;">{</span>
  constructor<span style="color: #7388d6;">(</span>props<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
    <span style="color: #A52A2A; font-weight: bold;">super</span><span style="color: #909183;">(</span>props<span style="color: #909183;">)</span>;
    <span style="color: #F5666D;">this</span>.state = <span style="color: #909183;">{</span>
      renderer: <span style="color: #4E9A06;">'canvas'</span>,
    <span style="color: #909183;">}</span>;
  <span style="color: #7388d6;">}</span>

  render<span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #909183;">{</span> renderer <span style="color: #909183;">}</span> = <span style="color: #F5666D;">this</span>.state;
    <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #909183;">{</span> trafficSitua <span style="color: #909183;">}</span> = <span style="color: #F5666D;">this</span>.props;
    <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #909183;">(</span>
      &lt;div
        style=<span style="color: #709870;">{</span><span style="color: #907373;">{</span>
          width: <span style="color: #4E9A06;">'5.375rem'</span>,
          height: <span style="color: #4E9A06;">'3.125rem'</span>,
        <span style="color: #907373;">}</span><span style="color: #709870;">}</span>&gt;
        <span style="color: #709870;">{</span>trafficSitua ? <span style="color: #907373;">(</span>
          &lt;Chart renderer=<span style="color: #6276ba;">{</span>renderer<span style="color: #6276ba;">}</span> option=<span style="color: #6276ba;">{</span>trafficOptions<span style="color: #858580;">(</span>trafficSitua<span style="color: #858580;">)</span><span style="color: #6276ba;">}</span> /&gt;
        <span style="color: #907373;">)</span> : <span style="color: #907373;">(</span>
          <span style="color: #4E9A06;">''</span>
        <span style="color: #907373;">)</span><span style="color: #709870;">}</span>
      &lt;/div&gt;
    <span style="color: #909183;">)</span>;
  <span style="color: #7388d6;">}</span> <span style="color: #204A87;">//</span><span style="color: #204A87;">endrender</span>
<span style="color: #707183;">}</span>

<span style="color: #A52A2A; font-weight: bold;">export</span> <span style="color: #A52A2A; font-weight: bold;">default</span> TrafficSituation;

</pre>
</div>

<p>
其中，相关数据信息是从上游，也就是leftpage组件流到该组件之内的。关于该数据如何流入到LeftPage，后续在介绍数据逻辑时进行介绍。
可以发现，该代码的核心步骤在于使用Chart组件进行数据和选项的配置，关于基础的Chart组件如何撰写，echarts提供了示例代码，如下：
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #A52A2A; font-weight: bold;">export</span> <span style="color: #A52A2A; font-weight: bold;">default</span> <span style="color: #A52A2A; font-weight: bold;">class</span> Chart <span style="color: #A52A2A; font-weight: bold;">extends</span> PureComponent <span style="color: #707183;">{</span>
  constructor<span style="color: #7388d6;">(</span>props<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
    <span style="color: #A52A2A; font-weight: bold;">super</span><span style="color: #909183;">(</span>props<span style="color: #909183;">)</span>;
    <span style="color: #F5666D;">this</span>.state = <span style="color: #909183;">{</span>
      width: <span style="color: #4E9A06;">'100%'</span>,
      height: <span style="color: #4E9A06;">'100%'</span>,
    <span style="color: #909183;">}</span>;
    <span style="color: #F5666D;">this</span>.chart = <span style="color: #F5666D;">null</span>;
  <span style="color: #7388d6;">}</span>
  <span style="color: #204A87;">// </span><span style="color: #204A87;">&#24322;&#27493;&#20989;&#25968;</span>
  <span style="color: #A52A2A; font-weight: bold;">async</span> componentDidMount<span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    <span style="color: #204A87;">// </span><span style="color: #204A87;">&#21021;&#22987;&#21270;&#22270;&#34920;</span>
    <span style="color: #A52A2A; font-weight: bold;">await</span> <span style="color: #F5666D;">this</span>.initChart<span style="color: #909183;">(</span><span style="color: #F5666D;">this</span>.el<span style="color: #909183;">)</span>;
    <span style="color: #204A87;">// </span><span style="color: #204A87;">&#23558;&#20256;&#20837;&#30340;&#37197;&#32622;(&#21253;&#21547;&#25968;&#25454;)&#27880;&#20837;</span>
    <span style="color: #F5666D;">this</span>.setOption<span style="color: #909183;">(</span><span style="color: #F5666D;">this</span>.props.option<span style="color: #909183;">)</span>;
    <span style="color: #204A87;">// </span><span style="color: #204A87;">&#30417;&#21548;&#23631;&#24149;&#32553;&#25918;&#65292;&#37325;&#26032;&#32472;&#21046; echart &#22270;&#34920;</span>
    window.addEventListener<span style="color: #909183;">(</span><span style="color: #4E9A06;">'resize'</span>, debounce<span style="color: #709870;">(</span><span style="color: #F5666D;">this</span>.resize, 100<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
  <span style="color: #7388d6;">}</span>

  componentDidUpdate<span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    <span style="color: #204A87;">// </span><span style="color: #204A87;">&#27599;&#27425;&#26356;&#26032;&#32452;&#20214;&#37117;&#37325;&#32622;</span>
    <span style="color: #F5666D;">this</span>.setOption<span style="color: #909183;">(</span><span style="color: #F5666D;">this</span>.props.option<span style="color: #909183;">)</span>;
  <span style="color: #7388d6;">}</span>

  componentWillUnmount<span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    <span style="color: #204A87;">// </span><span style="color: #204A87;">&#32452;&#20214;&#21368;&#36733;&#21069;&#21368;&#36733;&#22270;&#34920;</span>
    <span style="color: #F5666D;">this</span>.dispose<span style="color: #909183;">()</span>;
  <span style="color: #7388d6;">}</span>

  render<span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #909183;">{</span> width, height <span style="color: #909183;">}</span> = <span style="color: #F5666D;">this</span>.state;

    <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #909183;">(</span>
      &lt;div
        className=<span style="color: #4E9A06;">'default-chart'</span>
        ref=<span style="color: #709870;">{</span>el =&gt; <span style="color: #907373;">(</span><span style="color: #F5666D;">this</span>.el = el<span style="color: #907373;">)</span><span style="color: #709870;">}</span>
        style=<span style="color: #709870;">{</span><span style="color: #907373;">{</span> width, height <span style="color: #907373;">}</span><span style="color: #709870;">}</span>
      /&gt;
    <span style="color: #909183;">)</span>;
  <span style="color: #7388d6;">}</span>


  initChart = el =&gt; <span style="color: #7388d6;">{</span>
    <span style="color: #204A87;">// </span><span style="color: #204A87;">renderer &#29992;&#20110;&#37197;&#32622;&#28210;&#26579;&#26041;&#24335; &#21487;&#20197;&#26159; svg &#25110;&#32773; canvas</span>
    <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #0084C8; font-weight: bold;">renderer</span> = <span style="color: #F5666D;">this</span>.props.renderer || <span style="color: #4E9A06;">'canvas'</span>;

    <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Promise</span><span style="color: #909183;">(</span>resolve =&gt; <span style="color: #709870;">{</span>
      setTimeout<span style="color: #907373;">(</span><span style="color: #6276ba;">()</span> =&gt; <span style="color: #6276ba;">{</span>
        <span style="color: #F5666D;">this</span>.chart = echarts.init<span style="color: #858580;">(</span>el, <span style="color: #F5666D;">null</span>, <span style="color: #80a880;">{</span>
          renderer,
          width: <span style="color: #4E9A06;">'auto'</span>,
          height: <span style="color: #4E9A06;">'auto'</span>,
        <span style="color: #80a880;">}</span><span style="color: #858580;">)</span>;
        resolve<span style="color: #858580;">()</span>;
      <span style="color: #6276ba;">}</span>, 0<span style="color: #907373;">)</span>;
    <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
  <span style="color: #7388d6;">}</span>;

  setOption = option =&gt; <span style="color: #7388d6;">{</span>
    <span style="color: #A52A2A; font-weight: bold;">if</span> <span style="color: #909183;">(</span>!<span style="color: #F5666D;">this</span>.chart<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
      <span style="color: #A52A2A; font-weight: bold;">return</span>;
    <span style="color: #909183;">}</span>

    <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #0084C8; font-weight: bold;">notMerge</span> = <span style="color: #F5666D;">this</span>.props.notMerge;
    <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #0084C8; font-weight: bold;">lazyUpdate</span> = <span style="color: #F5666D;">this</span>.props.lazyUpdate;

    <span style="color: #F5666D;">this</span>.chart.setOption<span style="color: #909183;">(</span>option, notMerge, lazyUpdate<span style="color: #909183;">)</span>;
  <span style="color: #7388d6;">}</span>;
  dispose = <span style="color: #7388d6;">()</span> =&gt; <span style="color: #7388d6;">{</span>
    <span style="color: #A52A2A; font-weight: bold;">if</span> <span style="color: #909183;">(</span>!<span style="color: #F5666D;">this</span>.chart<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
      <span style="color: #A52A2A; font-weight: bold;">return</span>;
    <span style="color: #909183;">}</span>

    <span style="color: #F5666D;">this</span>.chart.dispose<span style="color: #909183;">()</span>;
    <span style="color: #F5666D;">this</span>.chart = <span style="color: #F5666D;">null</span>;
  <span style="color: #7388d6;">}</span>;
  resize = <span style="color: #7388d6;">()</span> =&gt; <span style="color: #7388d6;">{</span>
    <span style="color: #F5666D;">this</span>.chart &amp;&amp; <span style="color: #F5666D;">this</span>.chart.resize<span style="color: #909183;">()</span>;
  <span style="color: #7388d6;">}</span>;
  getInstance = <span style="color: #7388d6;">()</span> =&gt; <span style="color: #7388d6;">{</span>
    <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #F5666D;">this</span>.chart;
  <span style="color: #7388d6;">}</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
其中，purecomponent是一种较为特殊的component，该类仅仅当上游props发生改变或自身的state发生改变时才对自身进行重新渲染。
</p>

<p>
当对出口流量的组件形式了解后，另一个问题就是如何配置echarts对象，此处直接针对echarts官方提供的API参数进行修改即可。具体为：
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #A52A2A; font-weight: bold;">export</span> <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #0084C8; font-weight: bold;">trafficOptions</span> = <span style="color: #707183;">(</span>params<span style="color: #707183;">)</span> =&gt; <span style="color: #707183;">(</span><span style="color: #7388d6;">{</span>
  title: <span style="color: #909183;">{</span>
    show: <span style="color: #F5666D;">false</span>,
  <span style="color: #909183;">}</span>,
  legend: <span style="color: #909183;">{</span>
    show: <span style="color: #F5666D;">true</span>,
    top: <span style="color: #4E9A06;">'5%'</span>,
    textStyle: <span style="color: #709870;">{</span>
      color: <span style="color: #4E9A06;">'#c0c9d2'</span>,
    <span style="color: #709870;">}</span>,
  <span style="color: #909183;">}</span>,
  tooltip: <span style="color: #909183;">{</span>
    trigger: <span style="color: #4E9A06;">'axis'</span>,
    axisPointer: <span style="color: #709870;">{</span>
      lineStyle: <span style="color: #907373;">{</span>
        color: <span style="color: #6276ba;">{</span>
          type: <span style="color: #4E9A06;">'linear'</span>,
          x: 0,
          y: 0,
          x2: 0,
          y2: 1,
          colorStops: <span style="color: #858580;">[</span>
            <span style="color: #80a880;">{</span>
              offset: 0,
              color: <span style="color: #4E9A06;">'rgba(0, 255, 233,0)'</span>,
            <span style="color: #80a880;">}</span>,
            <span style="color: #80a880;">{</span>
              offset: 0.5,
              color: <span style="color: #4E9A06;">'rgba(255, 255, 255,1)'</span>,
            <span style="color: #80a880;">}</span>,
            <span style="color: #80a880;">{</span>
              offset: 1,
              color: <span style="color: #4E9A06;">'rgba(0, 255, 233,0)'</span>,
            <span style="color: #80a880;">}</span>,
          <span style="color: #858580;">]</span>,
          global: <span style="color: #F5666D;">false</span>,
        <span style="color: #6276ba;">}</span>,
      <span style="color: #907373;">}</span>,
    <span style="color: #709870;">}</span>,
  <span style="color: #909183;">}</span>,
  grid: <span style="color: #909183;">{</span>
    top: <span style="color: #4E9A06;">'15%'</span>,
    left: <span style="color: #4E9A06;">'10%'</span>,
    right: <span style="color: #4E9A06;">'5%'</span>,
    bottom: <span style="color: #4E9A06;">'10%'</span>,
  <span style="color: #909183;">}</span>,
  xAxis: <span style="color: #909183;">{</span>
    type: <span style="color: #4E9A06;">'category'</span>,
    axisLine: <span style="color: #709870;">{</span>
      show: <span style="color: #F5666D;">true</span>,
    <span style="color: #709870;">}</span>,
    splitArea: <span style="color: #709870;">{</span>
      color: <span style="color: #4E9A06;">'#f00'</span>,
      lineStyle: <span style="color: #907373;">{</span>
        color: <span style="color: #4E9A06;">'#f00'</span>,
      <span style="color: #907373;">}</span>,
    <span style="color: #709870;">}</span>,
    axisLabel: <span style="color: #709870;">{</span>
      color: <span style="color: #4E9A06;">'#BCDCF0'</span>,
    <span style="color: #709870;">}</span>,
    splitLine: <span style="color: #709870;">{</span>
      show: <span style="color: #F5666D;">false</span>,
    <span style="color: #709870;">}</span>,
    boundaryGap: <span style="color: #F5666D;">false</span>,
    data: params.timeList,
  <span style="color: #909183;">}</span>,

  yAxis: <span style="color: #909183;">{</span>
    type: <span style="color: #4E9A06;">'value'</span>,
    min: 0,
    splitLine: <span style="color: #709870;">{</span>
      show: <span style="color: #F5666D;">true</span>,
      lineStyle: <span style="color: #907373;">{</span>
        color: <span style="color: #4E9A06;">'rgba(255,255,255,0.1)'</span>,
      <span style="color: #907373;">}</span>,
    <span style="color: #709870;">}</span>,
    axisLine: <span style="color: #709870;">{</span>
      show: <span style="color: #F5666D;">true</span>,
    <span style="color: #709870;">}</span>,
    axisLabel: <span style="color: #709870;">{</span>
      show: <span style="color: #F5666D;">true</span>,
      margin: 10,
      textStyle: <span style="color: #907373;">{</span>
        color: <span style="color: #4E9A06;">'#d1e6eb'</span>,
      <span style="color: #907373;">}</span>,
    <span style="color: #709870;">}</span>,
    axisTick: <span style="color: #709870;">{</span>
      show: <span style="color: #F5666D;">false</span>,
    <span style="color: #709870;">}</span>,
  <span style="color: #909183;">}</span>,
  series: <span style="color: #909183;">[</span>
    <span style="color: #709870;">{</span>
      name: <span style="color: #4E9A06;">'&#36827;&#20837;&#20154;&#25968;'</span>,
      type: <span style="color: #4E9A06;">'line'</span>,
      smooth: <span style="color: #F5666D;">true</span>, <span style="color: #204A87;">//</span><span style="color: #204A87;">&#26159;&#21542;&#24179;&#28369;</span>
      lineStyle: <span style="color: #907373;">{</span>
        normal: <span style="color: #6276ba;">{</span>
          color: <span style="color: #4E9A06;">'#00b3f4'</span>,
          shadowColor: <span style="color: #4E9A06;">'rgba(0, 0, 0, .3)'</span>,
          shadowBlur: 0,
          shadowOffsetY: 5,
          shadowOffsetX: 5,
        <span style="color: #6276ba;">}</span>,
      <span style="color: #907373;">}</span>,
      label: <span style="color: #907373;">{</span>
        show: <span style="color: #F5666D;">false</span>,
        position: <span style="color: #4E9A06;">'top'</span>,
        textStyle: <span style="color: #6276ba;">{</span>
          color: <span style="color: #4E9A06;">'#00b3f4'</span>,
        <span style="color: #6276ba;">}</span>,
      <span style="color: #907373;">}</span>,
      <span style="color: #204A87;">// </span><span style="color: #204A87;">&#21435;&#38500;&#28857;&#26631;&#35760;</span>
      symbolSize: 0,
      <span style="color: #204A87;">// </span><span style="color: #204A87;">&#40736;&#26631;&#25918;&#19978;&#21435;&#36824;&#26159;&#35201;&#26377;&#39068;&#33394;&#30340;</span>
      itemStyle: <span style="color: #907373;">{</span>
        color: <span style="color: #4E9A06;">'#00b3f4'</span>,
      <span style="color: #907373;">}</span>,
      <span style="color: #204A87;">// </span><span style="color: #204A87;">&#35774;&#32622;&#28176;&#21464;&#33394;</span>
      areaStyle: <span style="color: #907373;">{</span>
        normal: <span style="color: #6276ba;">{</span>
          color: <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">echarts.graphic.LinearGradient</span><span style="color: #858580;">(</span>
            0,
            0,
            0,
            1,
            <span style="color: #80a880;">[</span>
              <span style="color: #887070;">{</span>
                offset: 0,
                color: <span style="color: #4E9A06;">'rgba(0,179,244,0.3)'</span>,
              <span style="color: #887070;">}</span>,
              <span style="color: #887070;">{</span>
                offset: 1,
                color: <span style="color: #4E9A06;">'rgba(0,179,244,0)'</span>,
              <span style="color: #887070;">}</span>,
            <span style="color: #80a880;">]</span>,
            <span style="color: #F5666D;">false</span>
          <span style="color: #858580;">)</span>,
          shadowColor: <span style="color: #4E9A06;">'rgba(0,179,244, 0.9)'</span>,
          shadowBlur: 20,
        <span style="color: #6276ba;">}</span>,
      <span style="color: #907373;">}</span>,
      data: params.outData,
    <span style="color: #709870;">}</span>,
    <span style="color: #709870;">{</span>
      name: <span style="color: #4E9A06;">'&#36208;&#20986;&#20154;&#25968;'</span>,
      type: <span style="color: #4E9A06;">'line'</span>,
      smooth: <span style="color: #F5666D;">true</span>, <span style="color: #204A87;">//</span><span style="color: #204A87;">&#26159;&#21542;&#24179;&#28369;</span>
      <span style="color: #204A87;">// </span><span style="color: #204A87;">&#38452;&#24433;</span>
      lineStyle: <span style="color: #907373;">{</span>
        normal: <span style="color: #6276ba;">{</span>
          color: <span style="color: #4E9A06;">'#00ca95'</span>,
          shadowColor: <span style="color: #4E9A06;">'rgba(0, 0, 0, .3)'</span>,
          shadowBlur: 0,
          shadowOffsetY: 5,
          shadowOffsetX: 5,
        <span style="color: #6276ba;">}</span>,
      <span style="color: #907373;">}</span>,
      label: <span style="color: #907373;">{</span>
        show: <span style="color: #F5666D;">false</span>,
        position: <span style="color: #4E9A06;">'top'</span>,
        textStyle: <span style="color: #6276ba;">{</span>
          color: <span style="color: #4E9A06;">'#00ca95'</span>,
        <span style="color: #6276ba;">}</span>,
      <span style="color: #907373;">}</span>,
      <span style="color: #204A87;">// </span><span style="color: #204A87;">&#21435;&#38500;&#28857;&#26631;&#35760;</span>
      symbolSize: 0,
      itemStyle: <span style="color: #907373;">{</span>
        color: <span style="color: #4E9A06;">'#00ca95'</span>,
      <span style="color: #907373;">}</span>,
      <span style="color: #204A87;">// </span><span style="color: #204A87;">&#35774;&#32622;&#28176;&#21464;&#33394;</span>
      areaStyle: <span style="color: #907373;">{</span>
        normal: <span style="color: #6276ba;">{</span>
          color: <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">echarts.graphic.LinearGradient</span><span style="color: #858580;">(</span>
            0,
            0,
            0,
            1,
            <span style="color: #80a880;">[</span>
              <span style="color: #887070;">{</span>
                offset: 0,
                color: <span style="color: #4E9A06;">'rgba(0,202,149,0.3)'</span>,
              <span style="color: #887070;">}</span>,
              <span style="color: #887070;">{</span>
                offset: 1,
                color: <span style="color: #4E9A06;">'rgba(0,202,149,0)'</span>,
              <span style="color: #887070;">}</span>,
            <span style="color: #80a880;">]</span>,
            <span style="color: #F5666D;">false</span>
          <span style="color: #858580;">)</span>,
          shadowColor: <span style="color: #4E9A06;">'rgba(0,202,149, 0.9)'</span>,
          shadowBlur: 20,
        <span style="color: #6276ba;">}</span>,
      <span style="color: #907373;">}</span>,
      data: params.inData,
    <span style="color: #709870;">}</span>,
  <span style="color: #909183;">]</span>,
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
通过这种方式，即可完成对一个echarts折线图的全部处理了。
</p>

<p>
另外的问题是，数据是如何从后端流入到当前组件的。依照react的思路，一般而言，数据的变动包含两个原则：
</p>
<ol class="org-ol">
<li>对于一个组件节点，如果该组件节点触发了状态变动，则依照变动情况进行处理：若只影响以当前节点为根节点的子树，则在当前节点改变，否则需要找到最小公共子树，在其之上改变状态，或在根节点改变状态。老师上课所写的todo APP即是此种逻辑；</li>
<li>对于一个组件节点，其所需要的数据，只能是自身状态提供的，或是父节点传递过来的；</li>
</ol>

<p>
此处自然也是基于这两个原则进行的，不过稍有不同。这里的不同主要体现在数据传送的方法上，同样以leftpage为例，数据从leftpage传送到各个子组件是遵循上述原则的。不过，由于直接同外界交互，leftpage获取数据是依照dva框架的形式进行的，该交互主要包括三个部分：数据来源，数据处理、数据导出展示。
</p>

<p>
比如，对于leftpage，需要获得两个对象，分别是人流量信息和图书排行榜信息，这些信息从后端获取，因此第一个操作是一个get操作。如果获取失败，则进入异常处理环节，否则便需要将获取得到的数据传入到leftpage组件之后，令之使用pros获得。
对于上述整个流程，在从后端获取数据的环节，主要代码是：
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #A52A2A; font-weight: bold;">export</span> <span style="color: #A52A2A; font-weight: bold;">default</span> <span style="color: #A52A2A; font-weight: bold;">function</span> request<span style="color: #707183;">(</span><span style="color: #0084C8; font-weight: bold;">url</span>, <span style="color: #0084C8; font-weight: bold;">options</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
  <span style="color: #A52A2A; font-weight: bold;">return</span> fetch<span style="color: #7388d6;">(</span>url, options<span style="color: #7388d6;">)</span>
    .then<span style="color: #7388d6;">(</span>checkStatus<span style="color: #7388d6;">)</span>
    .then<span style="color: #7388d6;">(</span>parseJSON<span style="color: #7388d6;">)</span>
    .then<span style="color: #7388d6;">(</span>data =&gt; <span style="color: #909183;">(</span><span style="color: #709870;">{</span> data <span style="color: #709870;">}</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
    .<span style="color: #A52A2A; font-weight: bold;">catch</span><span style="color: #7388d6;">(</span>err =&gt; <span style="color: #909183;">(</span><span style="color: #709870;">{</span> err <span style="color: #709870;">}</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #A52A2A; font-weight: bold;">export</span> <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #0084C8; font-weight: bold;">getLeftPageData</span> = <span style="color: #A52A2A; font-weight: bold;">async</span> <span style="color: #707183;">()</span> =&gt; <span style="color: #707183;">{</span>
  <span style="color: #A52A2A; font-weight: bold;">return</span> request<span style="color: #7388d6;">(</span><span style="color: #4E9A06;">'/api/leftPageData'</span><span style="color: #7388d6;">)</span>.then<span style="color: #7388d6;">(</span>response =&gt; <span style="color: #909183;">{</span>
    <span style="color: #A52A2A; font-weight: bold;">return</span> response.data;
  <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>;

</pre>
</div>

<p>
对于所获得的数据，dva会设置如下的model：
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #A52A2A; font-weight: bold;">export</span> <span style="color: #A52A2A; font-weight: bold;">default</span> <span style="color: #707183;">{</span>
  <span style="color: #204A87;">// </span><span style="color: #204A87;">&#21629;&#21517;&#31354;&#38388; (&#24517;&#22635;)</span>
  namespace: <span style="color: #4E9A06;">'leftPage'</span>,

  <span style="color: #204A87;">// </span><span style="color: #204A87;">&#25968;&#25454;</span>
  state: <span style="color: #7388d6;">{}</span>,

  <span style="color: #204A87;">// </span><span style="color: #204A87;">&#36335;&#30001;&#30417;&#21548;</span>
  subscriptions: <span style="color: #7388d6;">{</span>
    setup<span style="color: #909183;">(</span><span style="color: #709870;">{</span> dispatch, history <span style="color: #709870;">}</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
      <span style="color: #A52A2A; font-weight: bold;">return</span> history.listen<span style="color: #709870;">(</span><span style="color: #907373;">(</span>location, action<span style="color: #907373;">)</span> =&gt; <span style="color: #907373;">{</span>
        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#21442;&#25968;&#21487;&#20197;&#30452;&#25509;&#31616;&#20889;&#25104;{pathname}</span>
        <span style="color: #A52A2A; font-weight: bold;">if</span> <span style="color: #6276ba;">(</span>location.pathname === <span style="color: #4E9A06;">'/'</span><span style="color: #6276ba;">)</span> <span style="color: #6276ba;">{</span> <span style="color: #204A87;">//</span><span style="color: #204A87;">&#24403;&#36827;&#20837;&#24403;&#21069;&#39029;&#38754;&#23601;&#25191;&#34892;&#33719;&#21462;&#25968;&#25454;&#36825;&#19968;action</span>
          dispatch<span style="color: #858580;">(</span><span style="color: #80a880;">{</span> type: <span style="color: #4E9A06;">'getLeftPageData'</span> <span style="color: #80a880;">}</span><span style="color: #858580;">)</span>;
        <span style="color: #6276ba;">}</span>
      <span style="color: #907373;">}</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>,
  <span style="color: #7388d6;">}</span>,

  <span style="color: #204A87;">// </span><span style="color: #204A87;">&#24322;&#27493;&#35831;&#27714;    action&#22788;&#29702;&#22120;&#65292;&#29992;&#20197;&#23545;&#24322;&#27493;&#21160;&#20316;&#36827;&#34892;&#22788;&#29702;</span>
  effects: <span style="color: #7388d6;">{</span>
    *getLeftPageData<span style="color: #909183;">(</span><span style="color: #709870;">{</span> payload <span style="color: #709870;">}</span>, <span style="color: #709870;">{</span> call, put <span style="color: #709870;">}</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
      <span style="color: #A52A2A; font-weight: bold;">const</span> <span style="color: #0084C8; font-weight: bold;">data</span> = <span style="color: #A52A2A; font-weight: bold;">yield</span> call<span style="color: #709870;">(</span>getLeftPageData<span style="color: #709870;">)</span>; 
      <span style="color: #A52A2A; font-weight: bold;">if</span> <span style="color: #709870;">(</span>data<span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
        <span style="color: #A52A2A; font-weight: bold;">yield</span> put<span style="color: #907373;">(</span><span style="color: #6276ba;">{</span>
          type: <span style="color: #4E9A06;">'setData'</span>,
          payload: data,
        <span style="color: #6276ba;">}</span><span style="color: #907373;">)</span>;
      <span style="color: #709870;">}</span> <span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #709870;">{</span>
        console.log<span style="color: #907373;">(</span><span style="color: #4E9A06;">`&#33719;&#21462;&#24038;&#20391;&#25968;&#25454;&#25968;&#25454;&#22833;&#36133;`</span><span style="color: #907373;">)</span>;
      <span style="color: #709870;">}</span>
    <span style="color: #909183;">}</span>,
  <span style="color: #7388d6;">}</span>,

  <span style="color: #204A87;">// </span><span style="color: #204A87;">&#21516;&#27493;&#25805;&#20316;</span>
  reducers: <span style="color: #7388d6;">{</span>
    setData<span style="color: #909183;">(</span>state, action<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
      <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #709870;">{</span> ...state, ...action.payload <span style="color: #709870;">}</span>;
    <span style="color: #909183;">}</span>,
  <span style="color: #7388d6;">}</span>,
<span style="color: #707183;">}</span>;

</pre>
</div>

<p>
可以看出，该过程主要包含了如下几个部分：
</p>
<ol class="org-ol">
<li>路由监听，主要是设置何时进行dispatch，也就是什么时候进行数据获取；</li>
<li>effects，负责对异步动作进行处理，此处即是对获取左侧数据进行这一动作进行执行。同时，该过程使用了标准的yield-put结构，该结构会在需要时尝试运行一个动作，如果成功，则派发后续动作（put），以调用同步操作setData；</li>
<li>reducers，等价于原始react中的setState。</li>
</ol>

<p>
基于以上的介绍，整体的前端运行方式就较为清晰了。后续是如何对之进行安装和使用。
</p>
</div>
</div>
</div>


<div id="outline-container-org041ea0c" class="outline-2">
<h2 id="org041ea0c"><span class="section-number-2">3</span> 安装与运行</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org72de56f" class="outline-3">
<h3 id="org72de56f"><span class="section-number-3">3.1</span> 安装</h3>
<div class="outline-text-3" id="text-3-1">
<p>
基于npm进行依赖安装
</p>
<div class="org-src-container">
<pre class="src src-sh">npm install
</pre>
</div>
<p>
主要包括以下依赖：
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #4E9A06;">"dependencies"</span>: <span style="color: #707183;">{</span>
   <span style="color: #4E9A06;">"@jiaminghi/data-view-react"</span>: <span style="color: #4E9A06;">"^1.2.4"</span>,
   <span style="color: #4E9A06;">"dva"</span>: <span style="color: #4E9A06;">"^2.4.1"</span>,
   <span style="color: #4E9A06;">"echarts"</span>: <span style="color: #4E9A06;">"^4.9.0"</span>,
   <span style="color: #4E9A06;">"react"</span>: <span style="color: #4E9A06;">"^16.2.0"</span>,
   <span style="color: #4E9A06;">"react-dom"</span>: <span style="color: #4E9A06;">"^16.2.0"</span>,
   <span style="color: #4E9A06;">"sass-loader"</span>: <span style="color: #4E9A06;">"8.0.2"</span>,
   <span style="color: #4E9A06;">"styled-components"</span>: <span style="color: #4E9A06;">"^5.2.0"</span>
 <span style="color: #707183;">}</span>,
</pre>
</div>
<p>
其中，sass的安装可能会出现报错，可以先进行额外的处理。
</p>
</div>
</div>
<div id="outline-container-orgaa8a2c6" class="outline-3">
<h3 id="orgaa8a2c6"><span class="section-number-3">3.2</span> 运行</h3>
<div class="outline-text-3" id="text-3-2">
<p>
运行下列命令，即可在浏览器打开相关页面，F11进入全屏中即可使用。
</p>
<div class="org-src-container">
<pre class="src src-sh">npm start 
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: Sun Jul 11 17:08:49 2021</p>
<p class="author">Author: 梁子，软件学院，S0083，3120305385</p>
<p class="date">Created: 2022-03-26 周六 21:55</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
